<app-layout>
    <nz-page-header nzTitle="">
		<nz-breadcrumb nz-page-header-breadcrumb>
			<nz-breadcrumb-item><a routerLink="/dashboard"><i nz-icon nzType="home"></i></a></nz-breadcrumb-item>
			<nz-breadcrumb-item>Locations</nz-breadcrumb-item>
		</nz-breadcrumb>
    </nz-page-header>

    <div nz-row class="mb-1">
        <div nz-col nzSpan="6">
            <nz-input-group nzSearch [nzAddOnAfter]="suffixIconButton">
                <input type="text" nz-input placeholder="Search location by name" [(ngModel)]="searchValue">
            </nz-input-group>
            <ng-template #suffixIconButton>
                <button nz-button nzType="primary" nzSearch (click)="search()"><i nz-icon nzType="search"></i></button>
                <button nz-button nzType="default" (click)="reset()" nz-tooltip nzTooltipTitle="Reset" nzTooltipPlacement="top"><i nz-icon nzType="reload"></i></button>
            </ng-template>
        </div>
		<div nz-col nzSpan="18" class="text-right">
			<button nz-button [nzType]="'primary'" (click)="openDrawer('add')"><i nz-icon [nzType]="'plus'"></i> Add New Location</button>
		</div>
	</div>

    <div nz-row class="mb-3" nzGutter="24">
		<div nz-col nzXs="24" nzSm="24" nzLg="24">
            <!-- <nz-card> -->
                <nz-spin [nzSpinning]="isLoading">
                    <nz-table #basicTable [nzData]="locations" nzSize="small" nzPageSize="25" [nzBordered]="true">
                        <thead nzShowSizeChanger nzShowPagination>
                            <tr>
                                <th>ID</th>
                                <th>Name</th>
                                <th>Slug</th>
                                <th>Lookup Type</th>
                                <th>Parent</th>
                                <th>Is Active</th>
                                <th>Created At</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr *ngFor="let data of basicTable.data">
                                <td><span >{{data?.id}}</span></td>
                                <td>{{data?.name}}</td>
                                <td>{{data?.slug}}</td>
                                <td>{{data?.type_lookup_id}}</td>
                                <td>{{data?.parent_id}}</td>
                                <td>
                                    <nz-tag *ngIf="data?.is_active" [nzColor]="'success'">YES</nz-tag>
                                    <nz-tag *ngIf="!data?.is_active" [nzColor]="'error'">NO</nz-tag>
                                </td>
                                <td>{{data?.created_at | date: 'dd-MM-yyyy'}}</td>
                                <td>
                                    <a (click)="openDrawer('edit', data)">Edit</a>
                                    <nz-divider nzType="vertical"></nz-divider>
                                    <a
                                        nz-popconfirm
                                        nzPopconfirmTitle="Are you sure?"
                                        nzPopconfirmPlacement="bottom"
                                        (nzOnConfirm)="delete(data)"
                                        nzOkText="Yes">
                                        Delete
                                    </a>
                                </td>
                            </tr>
                        </tbody>
                    </nz-table>
                </nz-spin>
            <!-- </nz-card> -->
        </div>
    </div>
    <nz-drawer
    [nzBodyStyle]="{ height: 'calc(100% - 55px)', overflow: 'auto', 'padding-bottom': '53px' }"
    [nzMaskClosable]="false"
    [nzWidth]="500"
    [nzVisible]="visible"
    [nzTitle]="formTitle"
    (nzOnClose)="closeDrawer()"
  >
      <form nz-form [formGroup]="cotForm" (ngSubmit)="submitForm()" *ngIf="formAction=='add'">
          <div nz-row nzGutter="8">
              <div nz-col nzXs="24" nzMd="24">
                <nz-form-item>
                    <nz-form-label [nzSm]="6" [nzXs]="24" nzRequired nzFor="name">Name</nz-form-label>
                    <nz-form-control [nzSm]="18" [nzXs]="24" nzErrorTip="Name is required!">
                        <input type="text" nz-input formControlName="name" placeholder="Name *">
                    </nz-form-control>
                </nz-form-item>
              </div>
              <div nz-col nzXs="24" nzMd="24">
                <nz-form-item>
                    <nz-form-label [nzSm]="6" [nzXs]="24" nzRequired nzFor="slug">Slug</nz-form-label>
                    <nz-form-control [nzSm]="18" [nzXs]="24" nzErrorTip="Slug is required!">
                        <input type="text" nz-input formControlName="slug" placeholder="Slug *">
                    </nz-form-control>
                </nz-form-item>
              </div>
              <div nz-col nzXs="24" nzMd="24">
                <nz-form-item>
                    <nz-form-label [nzSm]="6" [nzXs]="24" nzRequired nzFor="type_lookup_id">Type</nz-form-label>
                    <nz-form-control [nzSm]="18" [nzXs]="24" nzErrorTip="Type is required!">
                        <nz-select formControlName="type_lookup_id" [nzPlaceHolder]="'Select Parent'">
                            <nz-option *ngFor="let p of lookups" [nzLabel]="p.lookup_label" [nzValue]="p.id"></nz-option>
                        </nz-select>
                    </nz-form-control>
                </nz-form-item>
              </div>

              <div nz-col nzXs="24" nzMd="24">
                  <nz-form-item>
                      <nz-form-label [nzSm]="6" [nzXs]="24" nzFor="parent_id">Parent</nz-form-label>
                      <nz-form-control [nzSm]="18" [nzXs]="24" nzErrorTip="Please select Parent!">
                        <nz-select formControlName="parent_id" [nzPlaceHolder]="'Select Parent'">
                            <nz-option *ngFor="let p of locations" [nzLabel]="p.name" [nzValue]="p.id"></nz-option>
                        </nz-select>
                      </nz-form-control>
                  </nz-form-item>
              </div>
              <div nz-col nzXs="24" nzMd="24">
                <nz-form-item>
                    <nz-form-label [nzSm]="6" [nzXs]="24" nzRequired nzFor="is_active">Active</nz-form-label>
                    <nz-form-control [nzSm]="18" [nzXs]="24" nzErrorTip="Select Active State!">
                      <nz-select formControlName="is_active" [nzPlaceHolder]="'Select Active State'">
                          <nz-option *ngFor="let p of active_states" [nzLabel]="p.label" [nzValue]="p.value"></nz-option>
                      </nz-select>
                    </nz-form-control>
                </nz-form-item>
              </div>
          </div>

          <div class="drawer-footer">
              <button type="button" (click)="closeDrawer()" class="ant-btn" style="margin-right: 8px;"><span>Cancel</span></button>
              <button nz-button [nzType]="'primary'" [disabled]="cotForm.invalid" [nzLoading]="isLoading"><span>Save</span></button>
          </div>
      </form>
      <form nz-form [formGroup]="cotForm2" (ngSubmit)="update()" *ngIf="formAction=='edit'">
          <div nz-row nzGutter="8">
            <div nz-col nzXs="24" nzMd="24">
                <nz-form-item>
                    <nz-form-control [nzSm]="18" [nzXs]="24">
                        <input type="hidden" nz-input formControlName="id">
                    </nz-form-control>
                </nz-form-item>
            </div>
            <div nz-col nzXs="24" nzMd="24">
                <nz-form-item>
                    <nz-form-label [nzSm]="6" [nzXs]="24" nzRequired nzFor="name">Name</nz-form-label>
                    <nz-form-control [nzSm]="18" [nzXs]="24" nzErrorTip="Name is required!">
                        <input type="text" nz-input formControlName="name" placeholder="Name *">
                    </nz-form-control>
                </nz-form-item>
              </div>
              <div nz-col nzXs="24" nzMd="24">
                <nz-form-item>
                    <nz-form-label [nzSm]="6" [nzXs]="24" nzRequired nzFor="slug">Slug</nz-form-label>
                    <nz-form-control [nzSm]="18" [nzXs]="24" nzErrorTip="Slug is required!">
                        <input type="text" nz-input formControlName="slug" placeholder="Slug *">
                    </nz-form-control>
                </nz-form-item>
              </div>
              <div nz-col nzXs="24" nzMd="24">
                <nz-form-item>
                    <nz-form-label [nzSm]="6" [nzXs]="24" nzRequired nzFor="type_lookup_id">Type</nz-form-label>
                    <nz-form-control [nzSm]="18" [nzXs]="24" nzErrorTip="Type is required!">
                        <nz-select formControlName="type_lookup_id" [nzPlaceHolder]="'Select Parent'">
                            <nz-option *ngFor="let p of lookups" [nzLabel]="p.lookup_label" [nzValue]="p.id"></nz-option>
                        </nz-select>
                    </nz-form-control>
                </nz-form-item>
              </div>

              <div nz-col nzXs="24" nzMd="24">
                  <nz-form-item>
                      <nz-form-label [nzSm]="6" [nzXs]="24" nzFor="parent_id">Parent</nz-form-label>
                      <nz-form-control [nzSm]="18" [nzXs]="24" nzErrorTip="Please select Parent!">
                        <nz-select formControlName="parent_id" [nzPlaceHolder]="'Select Parent'">
                            <nz-option *ngFor="let p of locations" [nzLabel]="p.name" [nzValue]="p.id"></nz-option>
                        </nz-select>
                      </nz-form-control>
                  </nz-form-item>
              </div>
              <div nz-col nzXs="24" nzMd="24">
                <nz-form-item>
                    <nz-form-label [nzSm]="6" [nzXs]="24" nzRequired nzFor="is_active">Active</nz-form-label>
                    <nz-form-control [nzSm]="18" [nzXs]="24" nzErrorTip="Select Active State!">
                      <nz-select formControlName="is_active" [nzPlaceHolder]="'Select Active State'">
                          <nz-option *ngFor="let p of active_states" [nzLabel]="p.label" [nzValue]="p.value"></nz-option>
                      </nz-select>
                    </nz-form-control>
                </nz-form-item>
              </div>
          </div>

          <div class="drawer-footer">
              <button type="button" (click)="closeDrawer()" class="ant-btn" style="margin-right: 8px;"><span>Cancel</span></button>
              <button nz-button [nzType]="'primary'" [disabled]="cotForm2.invalid" [nzLoading]="isLoading"><span>Save</span></button>
          </div>
      </form>
  </nz-drawer>

</app-layout>
